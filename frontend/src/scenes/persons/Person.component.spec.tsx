import '~/mocks/window' // must be before Person
import { Person } from 'scenes/persons/Person'
import React from 'react'
import { render, screen } from '@testing-library/react'
import '@testing-library/jest-dom'
import { defaultAPIMocks, mockAPI } from 'lib/api.mock'
import { initKea } from '~/initKea'
import { router } from 'kea-router'
import { getContext } from 'kea'
import { Provider } from 'react-redux'

// TODO does this need `mockPosthog` from cypress/support/helpers.js
jest.mock('posthog-js', () => ({
    onFeatureFlags: jest.fn(),
}))

jest.mock('lib/api')

describe('the person component', () => {
    beforeEach(() => {
        initKea()
        router.actions.push('/person/01779064-53be-000c-683f-23b1a8c8eb4c')
    })
    mockAPI(async (url) => {
        if (url.pathname == '_preflight/') {
            return {
                django: true,
                redis: true,
                plugins: true,
                celery: true,
                db: true,
                initiated: true,
                cloud: false,
                available_social_auth_providers: { 'google-oauth2': false, github: false, gitlab: false },
                ee_available: true,
                is_clickhouse_enabled: false,
                db_backend: 'postgres',
                available_timezones: {
                    'Africa/Abidjan': 0.0,
                    'Africa/Accra': 0.0,
                    'Africa/Addis_Ababa': 3.0,
                    'Africa/Algiers': 1.0,
                    'Africa/Asmara': 3.0,
                    'Africa/Bamako': 0.0,
                    'Africa/Bangui': 1.0,
                    'Africa/Banjul': 0.0,
                    'Africa/Bissau': 0.0,
                    'Africa/Blantyre': 2.0,
                    'Africa/Brazzaville': 1.0,
                    'Africa/Bujumbura': 2.0,
                    'Africa/Cairo': 2.0,
                    'Africa/Casablanca': 1.0,
                    'Africa/Ceuta': 2.0,
                    'Africa/Conakry': 0.0,
                    'Africa/Dakar': 0.0,
                    'Africa/Dar_es_Salaam': 3.0,
                    'Africa/Djibouti': 3.0,
                    'Africa/Douala': 1.0,
                    'Africa/El_Aaiun': 1.0,
                    'Africa/Freetown': 0.0,
                    'Africa/Gaborone': 2.0,
                    'Africa/Harare': 2.0,
                    'Africa/Johannesburg': 2.0,
                    'Africa/Juba': 2.0,
                    'Africa/Kampala': 3.0,
                    'Africa/Khartoum': 2.0,
                    'Africa/Kigali': 2.0,
                    'Africa/Kinshasa': 1.0,
                    'Africa/Lagos': 1.0,
                    'Africa/Libreville': 1.0,
                    'Africa/Lome': 0.0,
                    'Africa/Luanda': 1.0,
                    'Africa/Lubumbashi': 2.0,
                    'Africa/Lusaka': 2.0,
                    'Africa/Malabo': 1.0,
                    'Africa/Maputo': 2.0,
                    'Africa/Maseru': 2.0,
                    'Africa/Mbabane': 2.0,
                    'Africa/Mogadishu': 3.0,
                    'Africa/Monrovia': 0.0,
                    'Africa/Nairobi': 3.0,
                    'Africa/Ndjamena': 1.0,
                    'Africa/Niamey': 1.0,
                    'Africa/Nouakchott': 0.0,
                    'Africa/Ouagadougou': 0.0,
                    'Africa/Porto-Novo': 1.0,
                    'Africa/Sao_Tome': 0.0,
                    'Africa/Tripoli': 2.0,
                    'Africa/Tunis': 1.0,
                    'Africa/Windhoek': 2.0,
                    'America/Adak': -9.0,
                    'America/Anchorage': -8.0,
                    'America/Anguilla': -4.0,
                    'America/Antigua': -4.0,
                    'America/Araguaina': -3.0,
                    'America/Argentina/Buenos_Aires': -3.0,
                    'America/Argentina/Catamarca': -3.0,
                    'America/Argentina/Cordoba': -3.0,
                    'America/Argentina/Jujuy': -3.0,
                    'America/Argentina/La_Rioja': -3.0,
                    'America/Argentina/Mendoza': -3.0,
                    'America/Argentina/Rio_Gallegos': -3.0,
                    'America/Argentina/Salta': -3.0,
                    'America/Argentina/San_Juan': -3.0,
                    'America/Argentina/San_Luis': -3.0,
                    'America/Argentina/Tucuman': -3.0,
                    'America/Argentina/Ushuaia': -3.0,
                    'America/Aruba': -4.0,
                    'America/Asuncion': -4.0,
                    'America/Atikokan': -5.0,
                    'America/Bahia': -3.0,
                    'America/Bahia_Banderas': -5.0,
                    'America/Barbados': -4.0,
                    'America/Belem': -3.0,
                    'America/Belize': -6.0,
                    'America/Blanc-Sablon': -4.0,
                    'America/Boa_Vista': -4.0,
                    'America/Bogota': -5.0,
                    'America/Boise': -6.0,
                    'America/Cambridge_Bay': -6.0,
                    'America/Campo_Grande': -4.0,
                    'America/Cancun': -5.0,
                    'America/Caracas': -4.0,
                    'America/Cayenne': -3.0,
                    'America/Cayman': -5.0,
                    'America/Chicago': -5.0,
                    'America/Chihuahua': -6.0,
                    'America/Costa_Rica': -6.0,
                    'America/Creston': -7.0,
                    'America/Cuiaba': -4.0,
                    'America/Curacao': -4.0,
                    'America/Danmarkshavn': 0.0,
                    'America/Dawson': -7.0,
                    'America/Dawson_Creek': -7.0,
                    'America/Denver': -6.0,
                    'America/Detroit': -4.0,
                    'America/Dominica': -4.0,
                    'America/Edmonton': -6.0,
                    'America/Eirunepe': -5.0,
                    'America/El_Salvador': -6.0,
                    'America/Fort_Nelson': -7.0,
                    'America/Fortaleza': -3.0,
                    'America/Glace_Bay': -3.0,
                    'America/Goose_Bay': -3.0,
                    'America/Grand_Turk': -4.0,
                    'America/Grenada': -4.0,
                    'America/Guadeloupe': -4.0,
                    'America/Guatemala': -6.0,
                    'America/Guayaquil': -5.0,
                    'America/Guyana': -4.0,
                    'America/Halifax': -3.0,
                    'America/Havana': -4.0,
                    'America/Hermosillo': -7.0,
                    'America/Indiana/Indianapolis': -4.0,
                    'America/Indiana/Knox': -5.0,
                    'America/Indiana/Marengo': -4.0,
                    'America/Indiana/Petersburg': -4.0,
                    'America/Indiana/Tell_City': -5.0,
                    'America/Indiana/Vevay': -4.0,
                    'America/Indiana/Vincennes': -4.0,
                    'America/Indiana/Winamac': -4.0,
                    'America/Inuvik': -6.0,
                    'America/Iqaluit': -4.0,
                    'America/Jamaica': -5.0,
                    'America/Juneau': -8.0,
                    'America/Kentucky/Louisville': -4.0,
                    'America/Kentucky/Monticello': -4.0,
                    'America/Kralendijk': -4.0,
                    'America/La_Paz': -4.0,
                    'America/Lima': -5.0,
                    'America/Los_Angeles': -7.0,
                    'America/Lower_Princes': -4.0,
                    'America/Maceio': -3.0,
                    'America/Managua': -6.0,
                    'America/Manaus': -4.0,
                    'America/Marigot': -4.0,
                    'America/Martinique': -4.0,
                    'America/Matamoros': -5.0,
                    'America/Mazatlan': -6.0,
                    'America/Menominee': -5.0,
                    'America/Merida': -5.0,
                    'America/Metlakatla': -8.0,
                    'America/Mexico_City': -5.0,
                    'America/Miquelon': -2.0,
                    'America/Moncton': -3.0,
                    'America/Monterrey': -5.0,
                    'America/Montevideo': -3.0,
                    'America/Montserrat': -4.0,
                    'America/Nassau': -4.0,
                    'America/New_York': -4.0,
                    'America/Nipigon': -4.0,
                    'America/Nome': -8.0,
                    'America/Noronha': -2.0,
                    'America/North_Dakota/Beulah': -5.0,
                    'America/North_Dakota/Center': -5.0,
                    'America/North_Dakota/New_Salem': -5.0,
                    'America/Nuuk': -2.0,
                    'America/Ojinaga': -6.0,
                    'America/Panama': -5.0,
                    'America/Pangnirtung': -4.0,
                    'America/Paramaribo': -3.0,
                    'America/Phoenix': -7.0,
                    'America/Port-au-Prince': -4.0,
                    'America/Port_of_Spain': -4.0,
                    'America/Porto_Velho': -4.0,
                    'America/Puerto_Rico': -4.0,
                    'America/Punta_Arenas': -3.0,
                    'America/Rainy_River': -5.0,
                    'America/Rankin_Inlet': -5.0,
                    'America/Recife': -3.0,
                    'America/Regina': -6.0,
                    'America/Resolute': -5.0,
                    'America/Rio_Branco': -5.0,
                    'America/Santarem': -3.0,
                    'America/Santiago': -4.0,
                    'America/Santo_Domingo': -4.0,
                    'America/Sao_Paulo': -3.0,
                    'America/Scoresbysund': 0.0,
                    'America/Sitka': -8.0,
                    'America/St_Barthelemy': -4.0,
                    'America/St_Johns': -2.5,
                    'America/St_Kitts': -4.0,
                    'America/St_Lucia': -4.0,
                    'America/St_Thomas': -4.0,
                    'America/St_Vincent': -4.0,
                    'America/Swift_Current': -6.0,
                    'America/Tegucigalpa': -6.0,
                    'America/Thule': -3.0,
                    'America/Thunder_Bay': -4.0,
                    'America/Tijuana': -7.0,
                    'America/Toronto': -4.0,
                    'America/Tortola': -4.0,
                    'America/Vancouver': -7.0,
                    'America/Whitehorse': -7.0,
                    'America/Winnipeg': -5.0,
                    'America/Yakutat': -8.0,
                    'America/Yellowknife': -6.0,
                    'Antarctica/Casey': 11.0,
                    'Antarctica/Davis': 7.0,
                    'Antarctica/DumontDUrville': 10.0,
                    'Antarctica/Macquarie': 10.0,
                    'Antarctica/Mawson': 5.0,
                    'Antarctica/McMurdo': 12.0,
                    'Antarctica/Palmer': -3.0,
                    'Antarctica/Rothera': -3.0,
                    'Antarctica/Syowa': 3.0,
                    'Antarctica/Troll': 2.0,
                    'Antarctica/Vostok': 6.0,
                    'Arctic/Longyearbyen': 2.0,
                    'Asia/Aden': 3.0,
                    'Asia/Almaty': 6.0,
                    'Asia/Amman': 3.0,
                    'Asia/Anadyr': 12.0,
                    'Asia/Aqtau': 5.0,
                    'Asia/Aqtobe': 5.0,
                    'Asia/Ashgabat': 5.0,
                    'Asia/Atyrau': 5.0,
                    'Asia/Baghdad': 3.0,
                    'Asia/Bahrain': 3.0,
                    'Asia/Baku': 4.0,
                    'Asia/Bangkok': 7.0,
                    'Asia/Barnaul': 7.0,
                    'Asia/Beirut': 3.0,
                    'Asia/Bishkek': 6.0,
                    'Asia/Brunei': 8.0,
                    'Asia/Chita': 9.0,
                    'Asia/Choibalsan': 8.0,
                    'Asia/Colombo': 5.5,
                    'Asia/Damascus': 3.0,
                    'Asia/Dhaka': 6.0,
                    'Asia/Dili': 9.0,
                    'Asia/Dubai': 4.0,
                    'Asia/Dushanbe': 5.0,
                    'Asia/Famagusta': 3.0,
                    'Asia/Gaza': 3.0,
                    'Asia/Hebron': 3.0,
                    'Asia/Ho_Chi_Minh': 7.0,
                    'Asia/Hong_Kong': 8.0,
                    'Asia/Hovd': 7.0,
                    'Asia/Irkutsk': 8.0,
                    'Asia/Jakarta': 7.0,
                    'Asia/Jayapura': 9.0,
                    'Asia/Jerusalem': 3.0,
                    'Asia/Kabul': 4.5,
                    'Asia/Kamchatka': 12.0,
                    'Asia/Karachi': 5.0,
                    'Asia/Kathmandu': 5.75,
                    'Asia/Khandyga': 9.0,
                    'Asia/Kolkata': 5.5,
                    'Asia/Krasnoyarsk': 7.0,
                    'Asia/Kuala_Lumpur': 8.0,
                    'Asia/Kuching': 8.0,
                    'Asia/Kuwait': 3.0,
                    'Asia/Macau': 8.0,
                    'Asia/Magadan': 11.0,
                    'Asia/Makassar': 8.0,
                    'Asia/Manila': 8.0,
                    'Asia/Muscat': 4.0,
                    'Asia/Nicosia': 3.0,
                    'Asia/Novokuznetsk': 7.0,
                    'Asia/Novosibirsk': 7.0,
                    'Asia/Omsk': 6.0,
                    'Asia/Oral': 5.0,
                    'Asia/Phnom_Penh': 7.0,
                    'Asia/Pontianak': 7.0,
                    'Asia/Pyongyang': 9.0,
                    'Asia/Qatar': 3.0,
                    'Asia/Qostanay': 6.0,
                    'Asia/Qyzylorda': 5.0,
                    'Asia/Riyadh': 3.0,
                    'Asia/Sakhalin': 11.0,
                    'Asia/Samarkand': 5.0,
                    'Asia/Seoul': 9.0,
                    'Asia/Shanghai': 8.0,
                    'Asia/Singapore': 8.0,
                    'Asia/Srednekolymsk': 11.0,
                    'Asia/Taipei': 8.0,
                    'Asia/Tashkent': 5.0,
                    'Asia/Tbilisi': 4.0,
                    'Asia/Tehran': 4.5,
                    'Asia/Thimphu': 6.0,
                    'Asia/Tokyo': 9.0,
                    'Asia/Tomsk': 7.0,
                    'Asia/Ulaanbaatar': 8.0,
                    'Asia/Urumqi': 6.0,
                    'Asia/Ust-Nera': 10.0,
                    'Asia/Vientiane': 7.0,
                    'Asia/Vladivostok': 10.0,
                    'Asia/Yakutsk': 9.0,
                    'Asia/Yangon': 6.5,
                    'Asia/Yekaterinburg': 5.0,
                    'Asia/Yerevan': 4.0,
                    'Atlantic/Azores': 0.0,
                    'Atlantic/Bermuda': -3.0,
                    'Atlantic/Canary': 1.0,
                    'Atlantic/Cape_Verde': -1.0,
                    'Atlantic/Faroe': 1.0,
                    'Atlantic/Madeira': 1.0,
                    'Atlantic/Reykjavik': 0.0,
                    'Atlantic/South_Georgia': -2.0,
                    'Atlantic/St_Helena': 0.0,
                    'Atlantic/Stanley': -3.0,
                    'Australia/Adelaide': 9.5,
                    'Australia/Brisbane': 10.0,
                    'Australia/Broken_Hill': 9.5,
                    'Australia/Darwin': 9.5,
                    'Australia/Eucla': 8.75,
                    'Australia/Hobart': 10.0,
                    'Australia/Lindeman': 10.0,
                    'Australia/Lord_Howe': 10.5,
                    'Australia/Melbourne': 10.0,
                    'Australia/Perth': 8.0,
                    'Australia/Sydney': 10.0,
                    'Canada/Atlantic': -3.0,
                    'Canada/Central': -5.0,
                    'Canada/Eastern': -4.0,
                    'Canada/Mountain': -6.0,
                    'Canada/Newfoundland': -2.5,
                    'Canada/Pacific': -7.0,
                    'Europe/Amsterdam': 2.0,
                    'Europe/Andorra': 2.0,
                    'Europe/Astrakhan': 4.0,
                    'Europe/Athens': 3.0,
                    'Europe/Belgrade': 2.0,
                    'Europe/Berlin': 2.0,
                    'Europe/Bratislava': 2.0,
                    'Europe/Brussels': 2.0,
                    'Europe/Bucharest': 3.0,
                    'Europe/Budapest': 2.0,
                    'Europe/Busingen': 2.0,
                    'Europe/Chisinau': 3.0,
                    'Europe/Copenhagen': 2.0,
                    'Europe/Dublin': 1.0,
                    'Europe/Gibraltar': 2.0,
                    'Europe/Guernsey': 1.0,
                    'Europe/Helsinki': 3.0,
                    'Europe/Isle_of_Man': 1.0,
                    'Europe/Istanbul': 3.0,
                    'Europe/Jersey': 1.0,
                    'Europe/Kaliningrad': 2.0,
                    'Europe/Kiev': 3.0,
                    'Europe/Kirov': 3.0,
                    'Europe/Lisbon': 1.0,
                    'Europe/Ljubljana': 2.0,
                    'Europe/London': 1.0,
                    'Europe/Luxembourg': 2.0,
                    'Europe/Madrid': 2.0,
                    'Europe/Malta': 2.0,
                    'Europe/Mariehamn': 3.0,
                    'Europe/Minsk': 3.0,
                    'Europe/Monaco': 2.0,
                    'Europe/Moscow': 3.0,
                    'Europe/Oslo': 2.0,
                    'Europe/Paris': 2.0,
                    'Europe/Podgorica': 2.0,
                    'Europe/Prague': 2.0,
                    'Europe/Riga': 3.0,
                    'Europe/Rome': 2.0,
                    'Europe/Samara': 4.0,
                    'Europe/San_Marino': 2.0,
                    'Europe/Sarajevo': 2.0,
                    'Europe/Saratov': 4.0,
                    'Europe/Simferopol': 3.0,
                    'Europe/Skopje': 2.0,
                    'Europe/Sofia': 3.0,
                    'Europe/Stockholm': 2.0,
                    'Europe/Tallinn': 3.0,
                    'Europe/Tirane': 2.0,
                    'Europe/Ulyanovsk': 4.0,
                    'Europe/Uzhgorod': 3.0,
                    'Europe/Vaduz': 2.0,
                    'Europe/Vatican': 2.0,
                    'Europe/Vienna': 2.0,
                    'Europe/Vilnius': 3.0,
                    'Europe/Volgograd': 3.0,
                    'Europe/Warsaw': 2.0,
                    'Europe/Zagreb': 2.0,
                    'Europe/Zaporozhye': 3.0,
                    'Europe/Zurich': 2.0,
                    GMT: 0.0,
                    'Indian/Antananarivo': 3.0,
                    'Indian/Chagos': 6.0,
                    'Indian/Christmas': 7.0,
                    'Indian/Cocos': 6.5,
                    'Indian/Comoro': 3.0,
                    'Indian/Kerguelen': 5.0,
                    'Indian/Mahe': 4.0,
                    'Indian/Maldives': 5.0,
                    'Indian/Mauritius': 4.0,
                    'Indian/Mayotte': 3.0,
                    'Indian/Reunion': 4.0,
                    'Pacific/Apia': 13.0,
                    'Pacific/Auckland': 12.0,
                    'Pacific/Bougainville': 11.0,
                    'Pacific/Chatham': 12.75,
                    'Pacific/Chuuk': 10.0,
                    'Pacific/Easter': -6.0,
                    'Pacific/Efate': 11.0,
                    'Pacific/Enderbury': 13.0,
                    'Pacific/Fakaofo': 13.0,
                    'Pacific/Fiji': 12.0,
                    'Pacific/Funafuti': 12.0,
                    'Pacific/Galapagos': -6.0,
                    'Pacific/Gambier': -9.0,
                    'Pacific/Guadalcanal': 11.0,
                    'Pacific/Guam': 10.0,
                    'Pacific/Honolulu': -10.0,
                    'Pacific/Kiritimati': 14.0,
                    'Pacific/Kosrae': 11.0,
                    'Pacific/Kwajalein': 12.0,
                    'Pacific/Majuro': 12.0,
                    'Pacific/Marquesas': -9.5,
                    'Pacific/Midway': -11.0,
                    'Pacific/Nauru': 12.0,
                    'Pacific/Niue': -11.0,
                    'Pacific/Norfolk': 11.0,
                    'Pacific/Noumea': 11.0,
                    'Pacific/Pago_Pago': -11.0,
                    'Pacific/Palau': 9.0,
                    'Pacific/Pitcairn': -8.0,
                    'Pacific/Pohnpei': 11.0,
                    'Pacific/Port_Moresby': 10.0,
                    'Pacific/Rarotonga': -10.0,
                    'Pacific/Saipan': 10.0,
                    'Pacific/Tahiti': -10.0,
                    'Pacific/Tarawa': 12.0,
                    'Pacific/Tongatapu': 13.0,
                    'Pacific/Wake': 12.0,
                    'Pacific/Wallis': 12.0,
                    'US/Alaska': -8.0,
                    'US/Arizona': -7.0,
                    'US/Central': -5.0,
                    'US/Eastern': -4.0,
                    'US/Hawaii': -10.0,
                    'US/Mountain': -6.0,
                    'US/Pacific': -7.0,
                    UTC: 0.0,
                },
                opt_out_capture: false,
                posthog_version: '1.23.1',
                email_service_available: false,
                is_debug: 1,
                is_event_property_usage_enabled: false,
            }
        }
        if (url.pathname == 'api/projects/@current/') {
            return {
                id: 2,
                organization: '01777279-f5a2-0000-b1d5-dbfc148b9426',
                api_token: 'JqcIEQVjX-CxbPiittsio2ZTIB2pHUBmGVGgQE4Io0I',
                app_urls: [],
                name: 'HogFlix Demo App',
                slack_incoming_webhook: null,
                event_names: [
                    'watched_movie',
                    'installed_app',
                    'rated_app',
                    'purchase',
                    'entered_free_trial',
                    '$identify',
                    '$pageview',
                    '$autocapture',
                    'personalization skipped',
                    'insight viewed',
                    '$pageleave',
                    '$capture_metrics',
                ],
                event_properties: [
                    '$current_url',
                    'is_first_movie',
                    'plan',
                    'first_visit',
                    '$set',
                    '$ip',
                    '$os',
                    '$browser',
                    '$host',
                    '$pathname',
                    '$browser_version',
                    '$screen_height',
                    '$screen_width',
                    '$lib',
                    '$lib_version',
                    '$insert_id',
                    '$time',
                    'distinct_id',
                    '$device_id',
                    '$initial_referrer',
                    '$initial_referring_domain',
                    '$referrer',
                    '$referring_domain',
                    '$active_feature_flags',
                    '$user_id',
                    '$anon_distinct_id',
                    'token',
                    'posthog_version',
                    'has_slack_webhook',
                    '$event_type',
                    '$ce_version',
                    'is_first_component_load',
                    'insight',
                    'display',
                    'interval',
                    'filters',
                    'filters_count',
                    'events_count',
                    'actions_count',
                    'total_event_actions_count',
                    'phjs-_send_request',
                    'phjs-_send_request_inflight',
                    'phjs-capture',
                    'phjs-batch-enqueue',
                    'phjs-xhr-response',
                    'phjs-xhr-response-200',
                    'phjs-identify',
                    'phjs-batch-requests',
                    'phjs-batch-requests-e/',
                    'phjs-batch-handle',
                    'phjs-batch-handle-e/',
                    'phjs-batch-unload-requests',
                    'phjs-batch-unload-requests-e/',
                    'phjs-batch-unload',
                    'phjs-batch-unload-e/',
                ],
                event_properties_numerical: [
                    'purchase',
                    'app_rating',
                    'purchase_value',
                    '$browser_version',
                    '$screen_height',
                    '$screen_width',
                    '$time',
                    'has_slack_webhook',
                    '$ce_version',
                    'is_first_component_load',
                    'filters_count',
                    'events_count',
                    'actions_count',
                    'total_event_actions_count',
                    'phjs-_send_request',
                    'phjs-_send_request_inflight',
                    'phjs-capture',
                    'phjs-batch-enqueue',
                    'phjs-xhr-response',
                    'phjs-xhr-response-200',
                    'phjs-identify',
                    'phjs-batch-requests',
                    'phjs-batch-requests-e/',
                    'phjs-batch-handle',
                    'phjs-batch-handle-e/',
                    'phjs-batch-unload-requests',
                    'phjs-batch-unload-requests-e/',
                    'phjs-batch-unload',
                    'phjs-batch-unload-e/',
                ],
                created_at: '2021-02-05T13:55:31.489580Z',
                updated_at: '2021-02-05T13:55:52.852345Z',
                anonymize_ips: false,
                completed_snippet_onboarding: true,
                ingested_event: true,
                uuid: '01777279-f621-0000-1c87-13657da18040',
                opt_out_capture: false,
                is_demo: true,
            }
        }
        if (url.pathname == 'api/users/@me/') {
            return {
                id: '01788ed8-6d2d-0000-ccdb-d8e17589b1ea',
                distinct_id: 'kOyAmTq2McfCD5XvqwjKf8m6GVecm9uN0L0ypEoRN50',
                first_name: 'Jane',
                email: 'test@posthog.com',
                email_opt_in: true,
                anonymize_data: false,
                toolbar_mode: 'toolbar',
                has_password: true,
                is_staff: false,
                is_impersonated: false,
                team: {
                    id: 1,
                    uuid: '01787e47-55d7-0000-6976-b893a03aaba8',
                    organization: '01787e47-5558-0000-bae1-6bc513b42abe',
                    api_token: 'dtrwW0uEC7LwVx64RmZmqog_XjU0nXWuEK1d1ZpjteQ',
                    name: 'HogFlix Demo App',
                    completed_snippet_onboarding: true,
                    ingested_event: true,
                    is_demo: true,
                    timezone: 'UTC',
                },
                organization: {
                    id: '01787e47-5558-0000-bae1-6bc513b42abe',
                    name: 'Hogflix Movies',
                    created_at: '2021-03-29T13:58:27.416616Z',
                    updated_at: '2021-03-29T13:58:57.067131Z',
                    membership_level: 15,
                    personalization: {
                        role: 'engineer',
                        products: ['web', 'website'],
                        technical: 'technical',
                    },
                    setup: {
                        is_active: true,
                        current_section: 1,
                        any_project_ingested_events: false,
                        any_project_completed_snippet_onboarding: false,
                        non_demo_team_id: null,
                        has_invited_team_members: true,
                    },
                    plugins_access_level: 9,
                    teams: [
                        {
                            id: 1,
                            uuid: '01787e47-55d7-0000-6976-b893a03aaba8',
                            organization: '01787e47-5558-0000-bae1-6bc513b42abe',
                            api_token: 'dtrwW0uEC7LwVx64RmZmqog_XjU0nXWuEK1d1ZpjteQ',
                            name: 'HogFlix Demo App',
                            completed_snippet_onboarding: true,
                            ingested_event: true,
                            is_demo: true,
                            timezone: 'UTC',
                        },
                    ],
                    available_features: [],
                },
                organizations: [{ id: '01787e47-5558-0000-bae1-6bc513b42abe', name: 'Hogflix Movies' }],
            }
        }
        if (url.pathname == 'api/person/') {
            return {
                next: null,
                previous: null,
                results: [
                    {
                        id: 1,
                        name: 'smith.nunez@gmail.com',
                        distinct_ids: ['01779064-53be-000c-683f-23b1a8c8eb4c'],
                        properties: {
                            name: { last: 'Nunez', first: 'Smith' },
                            email: 'smith.nunez@gmail.com',
                            phone: '+1 (807) 451-2087',
                            address: '670 Stryker Street, Gloucester, Minnesota, 2058',
                            is_demo: true,
                        },
                        is_identified: true,
                        created_at: '2021-02-11T09:20:30.144219Z',
                        uuid: '01779064-53bc-0000-a361-f9762350be69',
                    },
                ],
            }
        }
        if (url.pathname == 'api/project/@current/events/') {
            return {
                next: null,
                results: [
                    {
                        id: '6e190b56-64dd-443d-832f-b889ea2df252',
                        distinct_id: '01779064-53be-000c-683f-23b1a8c8eb4c',
                        properties: {
                            $current_url: 'http://hogflix.com/3',
                            $browser: 'Firefox',
                            $lib: 'web',
                        },
                        event: '$pageview',
                        timestamp: '2021-02-11T09:21:30.202993+00:00',
                        person: {
                            distinct_ids: ['01777279-ff1b-0051-1fbd-b89614430f72'],
                            is_identified: true,
                            properties: { email: 'smith.nunez@gmail.com' },
                        },
                        elements: [],
                        elements_chain: '',
                    },
                    {
                        id: 'fb9e0e59-04aa-42e9-b561-61ecdc258c32',
                        distinct_id: '01779064-53be-000c-683f-23b1a8c8eb4c',
                        properties: {
                            price: 10,
                        },
                        event: 'purchase',
                        timestamp: '2021-02-11T09:21:30.202961+00:00',
                        person: {
                            distinct_ids: ['01777279-ff1b-0051-1fbd-b89614430f72'],
                            is_identified: true,
                            properties: { email: 'smith.nunez@gmail.com' },
                        },
                        elements: [],
                        elements_chain: '',
                    },
                    {
                        id: '903ca401-5824-4907-a00a-f6dd0484fde5',
                        distinct_id: '01779064-53be-000c-683f-23b1a8c8eb4c',
                        properties: {
                            $current_url: 'http://hogflix.com/2',
                            $browser: 'Firefox',
                            $lib: 'web',
                            $event_type: 'click',
                        },
                        event: '$autocapture',
                        timestamp: '2021-02-11T09:21:29.202931+00:00',
                        person: {
                            distinct_ids: ['01777279-ff1b-0051-1fbd-b89614430f72'],
                            is_identified: true,
                            properties: { email: 'smith.nunez@gmail.com' },
                        },
                        elements: [],
                        elements_chain: '',
                    },
                    {
                        id: '730ce2d4-f73b-4517-9e9b-743cca25497d',
                        distinct_id: '01779064-53be-000c-683f-23b1a8c8eb4c',
                        properties: {
                            $current_url: 'http://hogflix.com/2',
                            $browser: 'Firefox',
                            $lib: 'web',
                        },
                        event: '$pageview',
                        timestamp: '2021-02-11T09:21:00.202901+00:00',
                        person: {
                            distinct_ids: ['01777279-ff1b-0051-1fbd-b89614430f72'],
                            is_identified: true,
                            properties: { email: 'smith.nunez@gmail.com' },
                        },
                        elements: [],
                        elements_chain: '',
                    },
                    {
                        id: 'ef872ab0-56c5-4e46-bc87-b3bebbf0274b',
                        distinct_id: '01779064-53be-000c-683f-23b1a8c8eb4c',
                        properties: {
                            $current_url: 'http://hogflix.com/1',
                            $browser: 'Firefox',
                            $lib: 'web',
                            $event_type: 'click',
                        },
                        event: '$autocapture',
                        timestamp: '2021-02-11T09:20:59.202869+00:00',
                        person: {
                            distinct_ids: ['01777279-ff1b-0051-1fbd-b89614430f72'],
                            is_identified: true,
                            properties: { email: 'smith.nunez@gmail.com' },
                        },
                        elements: [],
                        elements_chain: '',
                    },
                    {
                        id: 'b0cfbc8d-203d-4af7-b663-2308f9fab579',
                        distinct_id: '01779064-53be-000c-683f-23b1a8c8eb4c',
                        properties: {
                            $current_url: 'http://hogflix.com',
                            $browser: 'Firefox',
                            $lib: 'web',
                            $event_type: 'click',
                        },
                        event: '$autocapture',
                        timestamp: '2021-02-11T09:20:44.202832+00:00',
                        person: {
                            distinct_ids: ['01777279-ff1b-0051-1fbd-b89614430f72'],
                            is_identified: true,
                            properties: { email: 'smith.nunez@gmail.com' },
                        },
                        elements: [],
                        elements_chain: '',
                    },
                    {
                        id: '96b47179-4ab2-43da-94d8-8df753b7bb3d',
                        distinct_id: '01779064-53be-000c-683f-23b1a8c8eb4c',
                        properties: {
                            $current_url: 'http://hogflix.com',
                            $browser: 'Firefox',
                            $lib: 'web',
                        },
                        event: '$pageview',
                        timestamp: '2021-02-11T09:20:30.202779+00:00',
                        person: {
                            distinct_ids: ['01777279-ff1b-0051-1fbd-b89614430f72'],
                            is_identified: true,
                            properties: { email: 'smith.nunez@gmail.com' },
                        },
                        elements: [],
                        elements_chain: '',
                    },
                ],
            }
        }
        if (url.pathname == 'api/projects/@current/property_definitions/') {
            return {
                count: 4,
                next: null,
                results: [
                    {
                        id: '01790132-ee4f-0000-a6ff-75e0040c6a59',
                        name: '$current_url',
                        description: '',
                        tags: [],
                        is_numerical: false,
                        updated_at: '2021-11-15T16:21:22.990111Z',
                        updated_by: null,
                        query_usage_30_day: 35,
                    },
                    {
                        id: '01790132-ee4f-0000-a6ff-75e0040c6a50',
                        name: '$browser',
                        description: '',
                        tags: [],
                        is_numerical: false,
                        updated_at: '2021-11-15T16:21:22.990111Z',
                        updated_by: null,
                        query_usage_30_day: 35,
                    },
                    {
                        id: '01790132-ee4f-0000-a6ff-75e0040c6a52',
                        name: '$lib',
                        description: '',
                        tags: [],
                        is_numerical: false,
                        updated_at: '2021-11-15T16:21:22.990111Z',
                        updated_by: null,
                        query_usage_30_day: 35,
                    },
                    {
                        id: '01790132-ee4f-0000-a6ff-75e0040c6a53',
                        name: '$event_type',
                        description: '',
                        tags: [],
                        is_numerical: false,
                        updated_at: '2021-11-15T16:21:22.990111Z',
                        updated_by: null,
                        query_usage_30_day: 35,
                    },
                ],
            }
        }
        if (url.pathname.match(/^api\/projects\/\d+\/event_definitions\//)) {
            return {
                count: 3,
                next: null,
                results: [
                    {
                        id: '01790132-e85f-0000-f42b-c40b152ca200',
                        name: '$pageview',
                        owner: {
                            distinct_id: '',
                            first_name: '',
                            email: '',
                        },
                        description: null,
                        tags: null,
                        volume_30_day: 750332,
                        query_usage_30_day: 1239,
                        updated_at: null,
                        updated_by: null,
                    },
                    {
                        id: '01790132-e85f-0000-f42b-c40b152ca201',
                        name: 'purchase',
                        owner: {
                            distinct_id: '',
                            first_name: '',
                            email: '',
                        },
                        description: null,
                        tags: null,
                        volume_30_day: 750332,
                        query_usage_30_day: 1239,
                        updated_at: null,
                        updated_by: null,
                    },
                    {
                        id: '01790132-e85f-0000-f42b-c40b152ca202',
                        name: '$autocapture',
                        owner: {
                            distinct_id: '',
                            first_name: '',
                            email: '',
                        },
                        description: null,
                        tags: null,
                        volume_30_day: 750332,
                        query_usage_30_day: 1239,
                        updated_at: null,
                        updated_by: null,
                    },
                ],
            }
        }
        return defaultAPIMocks(url)
    })

    it('shows user properties and events', () => {
        render(
            <Provider store={getContext().store}>
                <Person />
            </Provider>
        )
        expect(screen.getByText('smith.nunez@gmail.com', { selector: '[data-test-person-details]' })).toBeVisible()
        // fireEvent.click(screen.getByText('Load Greeting'))
        //
        // await waitFor(() => screen.getByRole('heading'))
        //
        // expect(screen.getByRole('heading')).toHaveTextContent('hello there')
        // expect(screen.getByRole('button')).toBeDisabled()
        //       mount()
        //
        //       cy.wait('@api_person').map(helpers.getSearchParameters).should('eql', {
        //           distinct_id: '01779064-53be-000c-683f-23b1a8c8eb4c',
        //       })
        //
        //       cy.get('[data-test-person-details]').contains('smith.nunez@gmail.com').should('be.visible')
        //
        //       cy.wait('@api_event').map(helpers.getSearchParameters).should('eql', {
        //           orderBy: '["-timestamp"]',
        //           person_id: '1',
        //           properties: '[]',
        //       })
        //
        //       cy.get('.event-row').should('have.length', 7)
    })
})
